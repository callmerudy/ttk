<html>
<head>
<title>TTK Manual</title>
<link href="manual.css" rel="stylesheet" type="text/css">
</head>

<body>


<h1>The TARSQI Toolkit Manual</h1>

<p class="subtitle">Release Notes and Manual for TTK Version 2.0.0.rc1.

<p class="subtitle">Marc Verhagen, January 2017.

<p class="navigation">
[ <a href="#intro">introduction</a>
| <a href="#prereq">installation</a>
| <a href="#using">getting started</a>
| <a href="#docs">documentation</a>
| <a href="#contact">contact</a>
| <a href="#future">future</a>
| <a href="#license">license</a>
]
</p>


<a name="intro"></a>

<h2>1. Introduction</h2>

<p>The Tarsqi Toolkit (also referred to here as TTK or the Toolkit) is a set of
components for extracting temporal information from news wire texts. TTK
extracts time expressions, events, subordination links and temporal links; in
addition, it can ensure consistency of temporal information.</p>

<p>The first version of the toolkit, version 1.0, was released in 2007,
accompanied by many promises and threats that there would be a new version
soon... it took a decade. Version 2.0.0 differs from version 1.0 in many
respects: code was simplified and debugged, documentation was updated, the
Mallet toolkit was used, stand-off annotation was adopted, libraries were
redesigned, and test and evaluation code was added. However, version 2.0.0 does
not significantly change the toolkit's performance in terms of speed or
precision and recall.</p>


<a name="prereq"></a>

<h2>2. Requirements and Installation</h2>

<p>The toolkit runs on recent versions of Linux and Mac OSX (and should run on
Windows, but see below). The code requires Python version 2.7, Perl version 5.8
or newer and the Java Development Kit (JDK) version 8 (version 7 will probably
work as well). Java is needed for running the third party software used by the
toolkit.</p>

<p>Installation is a four step process:</p>

<ol>

  <li>
    <p>Install the toolkit code. This is simply a matter of unpacking the
    downloaded archive or cloning the TTK Git repository
    at <a href="https://github.com/tarsqi/ttk.git">https://github.com/tarsqi/ttk.git</a>.</p>
  </li>

  <li>
    <p>Install the part-of-speech tagger. The Tarsqi toolkit is designed to work
      seamlessly with the IMS TreeTagger. Download the packages needed for your
      platform from
      the <a href="http://www.cis.uni-muenchen.de/~schmid/tools/TreeTagger/">TreeTagger
      website</a> and follow the directions. You can install the TreeTagger
      wherever you like, but you may need to tell the Toolkit where it can find
      the tagger (see below). There is an
      <a href="../../build/install-treetagger-osx.sh">example script</a> in the
      <code>build</code> directory which shows how to install the TreeTagger on
      Mac OSX. (Note: all directory and file names printed in this manual are
      relative to the path where TTK is installed).
  </li>

  <li>
    <p>Install MALLET. The classifiers in the Toolkit use the MAchine Learning
      for LanguagE Toolkit (McCallum, Andrew Kachites. "MALLET: A Machine
      Learning for Language Toolkit."
      <a href="http://mallet.cs.umass.edu">http://mallet.cs.umass.edu</a>. 2002). Download
      version 2.0.8
      from <a href="http://mallet.cs.umass.edu/download.php">http://mallet.cs.umass.edu/download.php</a>. Version
      2.0.7 will work as well. You can put MALLET wherever you want, but as with
      the TreeTagger you may need to tell the Toolkit where to find it. There is
      an <a href="../../build/install-mallet-osx.sh"> example script</a> in the
      <code>build</code> directory which shows how to install MALLET on Mac OSX.</p>
  </li>

  <li>
    <p>Create the settings file. The toolkit comes with an example settings file
      in <code>code/settings.sample.txt</code>. Copy that file into
      <code>code/settings.txt</code> and edit as needed. In most cases, the only
      settings you will need to change are the <code>treetagger</code>
      and <code>mallet</code> options, with the values depending on where you
      installed the TreeTagger and MALLET. If you use the same installation
      directories as the two example scripts mentioned above then you will not
      have to make any changes to the settings file.</p>
  </li>

</ol>

<p>To test the toolkit open a terminal window and make sure your working
directory is in the <code>code</code> directory of the distribution, then type
the following at the prompt (we use the dollar sign as the prompt in all
examples):</p>

<pre class="example">
$ python tarsqi.py data/in/simple-xml/tiny.xml out.xml
</pre>

<p>If all is well you will now have a file named <code>code/out.xml</code> with
  content similar to the output printed below.</p>

<pre class="example">
&lt;ttk>
&lt;text>

Fido sleeps today.

&lt;/text>
&lt;metadata>
  &lt;dct value="20170113"/>
&lt;/metadata>
&lt;source_tags>
  &lt;text id="1" begin="1" end="21" />
&lt;/source_tags>
&lt;tarsqi_tags>
  &lt;docelement id="d1" begin="2" end="20" origin="DOCSTRUCTURE" type="paragraph" />
  &lt;s id="s1" begin="2" end="20" origin="PREPROCESSOR" />
  &lt;lex id="l1" begin="2" end="6" lemma="Fido" origin="PREPROCESSOR"
       pos="NNP" text="Fido" />
  &lt;ng id="c1" begin="2" end="6" origin="PREPROCESSOR" />
  &lt;lex id="l2" begin="7" end="13" lemma="sleep" origin="PREPROCESSOR"
       pos="VBZ" text="sleeps" />
  &lt;vg id="c2" begin="7" end="13" origin="PREPROCESSOR" />
  &lt;EVENT begin="7" end="13" aspect="NONE" class="OCCURRENCE" eid="e1" eiid="ei1"
         epos="VERB" form="sleeps" origin="EVITA" pos="VBZ" tense="PRESENT" />
  &lt;lex id="l3" begin="14" end="19" lemma="today" origin="PREPROCESSOR"
       pos="NN" text="today" />
  &lt;ng id="c3" begin="14" end="19" origin="PREPROCESSOR" />
  &lt;TIMEX3 begin="14" end="19" origin="GUTIME" tid="t1" type="DATE" value="20170113" />
  &lt;lex id="l4" begin="19" end="20" lemma="." origin="PREPROCESSOR" pos="." text="." />
  &lt;TLINK eventInstanceID="ei1" origin="BLINKER-Type-1a"
         relType="IS_INCLUDED" relatedToTime="t1" />
  &lt;TLINK origin="LINK_MERGER"
         relType="INCLUDES" relatedToEventInstance="ei1" timeID="t1" />
&lt;/tarsqi_tags>
&lt;/ttk>
</pre>

<p>Your output file will be slightly different in that the value in
the <code>dct</code> tag will be the date you ran the test, there will also be
minor format changes because some tags were put on two lines above for display
purposes (TTK output has each tag on one line).</p>

<p><u>A note for Windows users</u>. TTK 1.0 depended on some software that did
not run on Windows. The current version does not have that problem and the code
should run on Windows. However, this has not been tested properly yet for TTK
version 2.0.0.rc1 and the above instructions may not be entirely correct for
Windows (for example, it may be the case that MALLET has to be installed in the
top level directory of the c: drive).</p>


<a name="using"></a>

<h2>3. Using the TARSQI Toolkit</h2>

<p>To run the TARSQI Toolkit, open a terminal and change the working directory
to the <code>code</code> directory of the distribution. You can run Tarsqi on a
file or a directory and the general format of the command is as follows:</p>

<pre class="example">
$ python tarsqi.py [OPTIONS] INFILE OUTFILE
$ python tarsqi.py [OPTIONS] INDIR OUTDIR
</pre>

<p>In the first invocation INFILE needs to exist but OUTFILE should not. In the
second invocation INDIR has to be a directory and OUTDIR either should not
exist, in which case it is created, or it should be a directory. In the latter
case you will be asked to confirm whether it is okay to overwrite files in
OUTDIR, if not, the program will exit. All files in INDIR will be processed
except for hidden files (starting with '.') and backup files (ending in '~').</p>

<p>There are several options you can use, none of them are mandatory. Options
can be set in the settings file (<code>code/settings.txt</code>) or overruled on
the command line. For a full list see the settings file and the module
documentation string in <code>code/tarsqi</code> (which can be browsed
at <a href="../code/modules/tarsqi.html">docs/code/modules/tarsqi.html</a>). Here
we just present the two options you are most likely to use, these options also
happen to shed light on how the toolkit works.</p>

<p><code>--source xml|text|ttk|timebank|...</code></p>

<div class="indent">

<p>The source type of the document allows components, especially the source
parser and the metadata parser, to be sensitive to idiosyncratic properties of
the text. There are three main types: <code>xml</code>, <code>text</code>
and <code>ttk</code>. The first type is the default, with it the toolkit will
assume that the input is well-formed XML and apart from that it will assume
nothing and just process any text it finds in the input file. With
the <code>xml</code> input type the system has no good way to determine
properties derived in an idiosyncratic way like the document creation time (DCT)
and it will simply use today's date. A future version will allow the DCT to be
handed in on the command line. This input type can be used for the files
in <code>code/data/in/simple-xml</code>. The <code>text</code> type is similar
to the <code>xml</code> type, except that it assumes that the entire content of
the file is to be parsed. Since the toolkit does not try to recognize any tags
this type should only be used for real raw text.</p>

<p>With both <code>xml</code> and <code>text</code> the output of the processing
will be in the TTK format, an example of which was given above for the result of
processing <code>code/data/in/simple.xml/tiny.xml</code>. The TTK format is a
standoff format which contains both the original unaltered text as well as the
tags added and it contains four main elements:

<ol>

<li>The <code>text</code> tag with in it the primary data of the input. In the
case of the <code>text</code> type this is simply the entire document, for
the <code>xml</code> type it is the document with all tags stripped (note that
this implies that for the <code>xml</code> type we consider the primary source
the document without the XML tags).</li>

<li>The <code>metadata</code> tag which has a dictionary with meta data, which
at this point only contains the value of the DCT.</li>

<li>The <code>source_tags</code> tag which has all tags that were available in
the input, this is empty for the <code>text</code> type.</li>

<li>The<code>tarsqi_tags</code> tag which has a list of all tags added by the
toolkit.</li>

</ol>

<p>The <code>ttk</code> source type tells the toolkit that the input is in the
TTK format. Typically the input here would be a file previously processed but
the toolkit or a file that was converted into the TTK format.</p>

<p>The <code>timebank</code> source type is an example of a specific source
type. When using this for one of the files in <code>code/data/in/TimeBank</code>
the toolkit will know where to find the DCT, which in the TimeBank case is in
the file name or in some tag in the input.</p>

</div>

<!--
<code>timebank</code>
<blockquote>
This input type is very similar to <code>simple-xml</code>, the main
difference is that it activates a component that parses document
creation times for the various TimeBank formats. This input type can
be used for the files in <code>code/data/in/TimeBank</code>, which
consists of all TimeBank files with all tags (except some document
level tags) stripped out.  
</blockquote>

<code>rte3</code>
<blockquote>
Use this input type when processing pre-processed data from
<code>code/data/in/RTE3</code>, which contains data from the <a
href="http://www.pascal-network.org/Challenges/RTE3/">Third Pascal
Textual Entailment Challenge</a>. 
</blockquote>
-->

<p><code>--pipeline STRING</code></p>

<div class="indent">

<p>Can be used to overrule the default pipeline specified
in <code>code/settings.txt</code>. A pipeline is a comma-separated string of
component names. Allowed component names are <code>PREPROCESSOR, TOKENIZER,
TAGGER, CHUNKER, GUTIME, EVITA, SLINKET, S2T, BLINKER, CLASSIFIER</code> and
<code>LINK_MERGER</code>. The order of the components in the pipeline
specification is significant. Some examples are:</p>

<pre class="example">
--pipeline PREPROCESSOR,GUTIME,EVITA
--pipeline TOKENIZER,TAGGER,CHUNKER,GUTIME,EVITA
--pipeline SLINKET,S2T,BLINKER,CLASSIFIER,LINK_MERGER
--pipeline PREPROCESSOR,GUTIME,EVITA,SLINKET,S2T,BLINKER,CLASSIFIER
</pre>

<p>The first example instructs TTK to take a file, preprocess it and add time
expressions and events. The second example is identical except that individual
preprocessing modules are used instead of the PREPROCESSOR shorthand. For the
third example, preprocessing, times and events are taken for granted and only
links are added. In this case the input needs to be a ttk file which has the
needed information. The fourth example is almost like the default except that
the link merger component is left out, this is useful for large files since the
merger component slows down on large file.</p>

</div>

<p>To end this section here is an example to illustrate the interaction of
the <code>--source</code> and <code>--pipeline</code> options:</p>

<pre class="example">
$ python tarsqi.py --source xml --pipeline TOKENIZER test.xml test.tokenized.xml
$ python tarsqi.py --source ttk --pipeline TAGGER test.tokenized.xml test.tagged.xml
</pre>

<p>Note how the second line uses the ttk source type because output is always in
the TTK format.</p>


<a name="docs"></a>

<h2>4. Documentation</h2>

<p>There is more documentation apart from the installation notes and minimal
manual in this document. All documentation is in the <code>docs</code>
directory. Some of it is quite useful, but some documents are there merely for
historical reasons. Here is a short description for each subdirectory
in <code>docs</code>:</p>

<table cellspacing="0" cellpadding="5" border="1">

<tr valign=top>
<td>docs/code</td>
<td>The Python code's documentation can be browsed
at <a href="../code/index.html">docs/code/index.html</a>, which has a list of
links to all modules. For each module the documentation strings for classes and
functions are printed. Documentation of the code is uneven: some modules are
well-documented, other have spotty and underwhelming documentation or are not
documented at all. The pages are generated with the
<code>code/utilities/make_documentation.py</code> script, which was created
because the <code>pydoc</code> command used to crash on many of the toolkit
modules.</td>
</tr>

<tr valign=top>
<td>docs/design</td>
<td>Notes on the design of the toolkit and the algorithms used in many
components are
in <a href="../design/index.html">docs/design/index.html</a>. These notes are a
work in progress and many sections are unfinished. There is a list of tags
generated
in <a href="../design/1-toplevel.html#tags">docs/design/1-toplevel.html#tags</a>.</td>
</tr>

<tr valign=top>
<td>docs/manual</td>
<td>Contains the document you are reading now.</td>
</tr>

<tr valign=top>
<td>docs/notes</td>
<td>Various notes, mostly out of date.</td>
</tr>

<tr valign=top>
<td>docs/papers</td>
<td>Toolkit publications.</td>
</tr>

<tr valign=top>
<td>docs/specifications</td>
<td>Contains a document written a decade ago, for historical interest only.</td>
</tr>

<tr valign=top>
<td>docs/tracking</td>
<td>Some old bugs and feature requests that will be folded into the GitHub site
or else be discarded.</td>
</tr>

</table>


<!--
<a name="issues"></a>

<h2>7. Known Issues</h2>

<li>Bad CPU type in executable

<p>This error may be thrown by the bin/tree-tagger executable in the treetagger
directory. You have the wrong executable. Install the correct version for your
operating system.</p>

<li>TreeTagger parameter file invalid: english.par

<p>This is thrown by components.preprocessing.treetaggerwrapper.TreeTaggerError
and it can occur when your versions of the treetagger and the treetaggerwrapper
script are out of sync. Find the line

<blockquote>
"tagparfile": "english.par",
</blockquote>

and replace it with

<blockquote>
"tagparfile": "english-utf8.par",
</blockquote>

Note that this should really be fixed by using the new treetaggerwrapper.</p>
-->

<!--
<a name=contrib><h2>7. Contributors</h2></a>

Many people have contributed to the Tarsqi toolkit, they are listed
here in alphabetical order: Catherine Havasi, Seokbae Jang, Bob
Knippen, Congmin Lee, Inderjeet Mani, Emin Mimaroglu, Jessica
Moszkowicz, Feng Pan, Alex Plotnick, James Pustejovsky, Hongyuan Qiu,
Anna Rumshisky, Roser Saur&iacute;, Barry Schiffman, Amber Stubbs,
Marc Verhagen, and Ben Wellner.

<p>
The Tango annotation tool was developed by Linda van Guilder, Andrew
See, Bob Knippen and Alex Baron.
-->


<a name="contact"></a>

<h2>5. Contact</h2>

<p>Please send an email to ttk-bugs@timeml.org with any issue, question or
comment you may have. When reporting a bug, please be as specific as you
can.</p>


<a name="future"></a>

<h2>6. Future Releases</h2>

<p>The next releases of the TTK will most likely not take a decade. First, there
will be several more release candidates for version 2.0.0 (2.0.0.rc2, 2.0.0.rc3
etcetera). This is the wish list for 2.0.0 (this list changes all the time, an
up to date version is
on <a href="https://github.com/tarsqi/ttk/issues/40">GitHub</a>):</p>

<ul>

<li>Test code on Windows and update manual accordingly if needed.</li>

<li>Any serious or less serious issues that may pop up, including the following
already listed on the github repository:

<ul>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/15">
    issue 15: confirm correctness of character offsets</a>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/19">
    issue 19: various documentation updates</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/21">issue 21:
    test removal of GUTime tmp files</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/23">
    issue 23: use confidence scores in merger component</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/29">
    issue 29: update old TimeML library in Slinket</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/32">
    issue 32: fix bug with duplicate attribute</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/37">
    issue 37: clarify preprocessor modules</a></li>
<li>
  <a href="https://github.com/tarsqi/ttk/issues/38">
    issue 38: fix missing link identifiers</a></li>
</ul>
</li>

<li>Add a --dct command line option</li>

<li>Add documentation on how to test and evaluate components</li>

</ul>

<p>For the longer run, the following items are on the agenda:</P>

<ul>

<li>Any other issue listed
on <a href="https://github.com/tarsqi/ttk/issues">https://github.com/tarsqi/ttk/issues</a></li>

<li>Add reference intervals to the temporal closure code, which should reduce
time complexity. Consider implementing parts in C or Java.</li>

<li>Finish implementation of BTime.</li>

<li>Revisit the rules in Blinker. May include revisiting old GutenLink rules.</li>

<li>Hook up the toolkit to other pre-processing components (for example the NLTK
toolkit and HeidelTime).</li>

<li>Add browsers and editors for the dictionaries and pattern sets.</li>

</ul>


<a name="license"></a>

<h2>7. Copyright and License</h2>

<p>The Tarsqi Toolkit is copyright &copy;2017 of Brandeis University and is
distributed under the <a rel="license"
href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2 License</a>.</p>

<p>The Tempex module is copyright of The MITRE corporation and is distributed
under the license in <a href="tempex-license.pdf">tempex-license.pdf</a>.</p>

<p>The data in <code>code/data/in/TimeBank</code> are copyrighted by the
various content providers and can be used for academic purposes only.</p>

</body>
</html>
