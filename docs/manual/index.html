<html>
<head>
<link href="manual.css" rel="stylesheet" type="text/css">
</head>

<body>


<h1>The TARSQI Toolkit</h1>

<p>Release Notes and Manual for Version 2.

<p>Marc Verhagen, January 2017.



<h2>Introduction</h2>

<p>The Tarsqi Toolkit (also referred to as TTK or the Toolkit) is a set of
components for extracting temporal information from news wire texts. TTK
extracts time expressions, events, subordination links and temporal links; in
addition, it can ensure consistency of temporal
information. See <a href="http://tarsqi.org">http://tarsqi.org</a> for more
general information on the TARSQI project and for descriptions of TTK and its
components.</p>

<p>The first version of the toolkit, version 1.0, was released in 2007,
accompanied by many promises and threats that there would be a new version
soon... it took a decade. Version 2.0.0 differs from version 1.0 in many
respects: code was simplified and debugged, documentation was updated, the
Mallet toolkit was used, stand-off annotation was adopted, libraries were
redesigned, and test and evaluation code was added. However, version 2.0.0 does
not significantly change the toolkit's performance in terms of precision and
recall.</p>


<p>This manual contains the following sections:

<ol>
<li><a href="#license">Copyright and License</a></li>
<li><a href="#prereq">Prerequisites and Installation</a></li>
<li><a href="#using">Using the Tarsqi Toolkit</a></li>
<li><a href="#codedocs">More Documentation</a></li>
<li><a href="#contrib">Contributors</a></li>
<li><a href="#contact">Contact</a></li>
<li><a href="#future">Future Work</a></li>
</ol>



<a name="license"><h2>1. Copyright and License</h2></a>


<p>The Tarsqi Toolkit is copyright &copy;2017 of Brandeis University and is
distributed under the <a rel="license"
href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2 License</a>.</p>

<p>The Tempex module is copyright of The MITRE corporation and is distributed
under the license in <a href="tempex-license.pdf">tempex-license.pdf</a>.</p>

<p>The data in <code>data/in/TimeBank</code> are copyrighted by the
various content providers and can be used for academic purposes only.</p>


<a name="prereq"><h2>2. Requirements and Installation</h2></a>

<p>The toolkit runs on recent versions of Linux and Mac OSX (and should run on
Windows, but see below). The code requires Python version 2.7, Perl version 5.8
and the Java developerâ€™s kit (JDK) version 8 (version 7 will probably work as
well). Java is needed for running the third party software used by the
toolkit.</p>

<p>Installation is a four step process:</p>

<ol>

  <li>
    <p>Install the toolkit code. This is simply a matter of unpacking the
    downloaded archive or cloning the TTK Git repository
    at <a href="https://github.com/tarsqi/ttk.git">https://github.com/tarsqi/ttk.git</a>.</p>
  </li>

  <li>
    <p>Install the Part-of-Speech Tagger. The Tarsqi toolkit is designed
      to work seamlessly with the IMS TreeTagger. Download the packages needed
      for your platform from
      the <a href="http://www.cis.uni-muenchen.de/~schmid/tools/TreeTagger/">TreeTagger
      website</a> and follow the directions. You can install the TreeTagger
      wherever you like, but you will need to tell the Toolkit where it can find
      the tagger (see below).
  </li>

  <li>
    <p>Install MALLET. The classifiers in the Toolkit use the MAchine Learning
      for LanguagE Toolkit (McCallum, Andrew Kachites. "MALLET: A Machine
      Learning for Language Toolkit."
	<a href="http://mallet.cs.umass.edu">http://mallet.cs.umass.edu</a>. 2002). Download
	version 2.0.8
	from <a href="http://mallet.cs.umass.edu/download.php">http://mallet.cs.umass.edu/download.php</a>. Version
	2.0.7 will most likely work as well. You can put Mallet wherever you
	want, but as with the TreeTagger you need to tell the Toolkit where to
	find MALLET.</p>
  </li>

  <li>
    <p>Create and edit the settings.txt file. The toolkit comes with an example
      file with settings in <code>code/settings.sample.txt</code>. Copy that
      file into code/settings.txt and edit it as needed. In most cases, the only
      settings you will need to change are the <code>treetagger</code>
      and <code>mallet</code> options, with the values depending on where you
      installed the TreeTagger and MALLET.</p>
  </li>

</ol>

<p>To test the toolit open a terminal and makes sure your working directory is
in the <code>code</code> directory of the distribution, then type the
following:</p>

<pre class="example">
python tarsqi.py data/in/simple-xml/test.xml out.xml
</pre>

<p>If all is well you will now have a file named <code>out.xml</code> with the
  content below (but note that the value in the dct tag will be today's date and
  that tags will be on one line).</p>

<pre class="example">
&lt;ttk>
&lt;text>

Fido sleeps today.

&lt;/text>
&lt;metadata>
  &lt;dct value="20170113"/>
&lt;/metadata>
&lt;source_tags>
  &lt;text id="1" begin="1" end="14" />
&lt;/source_tags>

&lt;tarsqi_tags>
  &lt;docelement id="d1" begin="2" end="20" origin="DOCSTRUCTURE" type="paragraph" />
  &lt;s id="s1" begin="2" end="20" origin="PREPROCESSOR" />
  &lt;lex id="l1" begin="2" end="6" lemma="Fido" origin="PREPROCESSOR"
       pos="NNP" text="Fido" />
  &lt;ng id="c1" begin="2" end="6" origin="PREPROCESSOR" />
  &lt;lex id="l2" begin="7" end="13" lemma="sleep" origin="PREPROCESSOR"
       pos="VBZ" text="sleeps" />
  &lt;vg id="c2" begin="7" end="13" origin="PREPROCESSOR" />
  &lt;EVENT begin="7" end="13" aspect="NONE" class="OCCURRENCE" eid="e1" eiid="ei1"
         epos="VERB" form="sleeps" origin="EVITA" pos="VBZ" tense="PRESENT" />
  &lt;lex id="l3" begin="14" end="19" lemma="today" origin="PREPROCESSOR"
       pos="NN" text="today" />
  &lt;ng id="c3" begin="14" end="19" origin="PREPROCESSOR" />
  &lt;TIMEX3 begin="14" end="19" origin="GUTIME" tid="t1" type="DATE" value="20170113" />
  &lt;lex id="l4" begin="19" end="20" lemma="." origin="PREPROCESSOR" pos="." text="." />
  &lt;TLINK eventInstanceID="ei1" origin="BLINKER-Type-1a"
         relType="IS_INCLUDED" relatedToTime="t1" />
  &lt;TLINK origin="LINK_MERGER"
         relType="INCLUDES" relatedToEventInstance="ei1" timeID="t1" />
&lt;/tarsqi_tags>
&lt;/ttk>
</pre>

<p>A note for Windows users. TTK 1.0 depended on some software that did not run
on Windows. Thecurrent version does not have that problem and the code should
run on Windows. THis has not been tested properly yet and the above instructions
may not be entirely correct for Windows (for example, it may be the case that
MALLET has to be installed in the top level directory of the c: drive).</p>


<a name="using"><h2>3. Using the TARSQI Toolkit</h2></a>


To run the TARSQI Toolkit, open a terminal, change the working
directory to the <code>code</code> directory of the distribution and
type

<pre class="example">
python tarsqi.py --source data/in/simple-xml/test.xml out.xml
</pre>


The following input types are defined:

<blockquote>

<code>xml</code>

<blockquote>
An input type that should be used for default XML. It assumes that a
document contains a tag named TEXT that wraps the data that need to be
parsed and that the data have not yet been processed in any way. The
value of the tag that wraps the data can be overridden using the
content_tag flag (see below). This input type can be used for the
files in <code>code/data/in/simple-xml</code>.
</blockquote>

<code>timebank</code>

<blockquote>
This input type is very similar to <code>simple-xml</code>, the main
difference is that it activates a component that parses document
creation times for the various TimeBank formats. This input type can
be used for the files in <code>code/data/in/TimeBank</code>, which
consists of all TimeBank files with all tags (except some document
level tags) stripped out.  
</blockquote>


<code>rte3</code>

<blockquote>
Use this input type when processing pre-processed data from
<code>code/data/in/RTE3</code>, which contains data from the <a
href="http://www.pascal-network.org/Challenges/RTE3/">Third Pascal
Textual Entailment Challenge</a>. 
</blockquote>

</blockquote>


<p>Flags are feature-value pairs where the feature and value are
separated by an equals sign. The following flags are defined:</p>

<code>--trap-errors True|False</code>

<blockquote>
Determines whether errors inside of components are trapped. The
default is that errors are trapped.
</blockquote>


<code>--pipeline String</code>

<blockquote>
Can be used to overrule the default pipeline determined by the data
source identifier. A pipeline is a comma-separated string of component
names. Allowed component names are <code>PREPROCESSOR, GUTIME, EVITA,
SLINKET, S2T, BLINKER, CLASSIFIER</code> and
<code>LINK_MERGER</code>. The order of the components in the pipeline
specification is significant. Some examples are:

<blockquote>
<code>
--pipeline PREPROCESSOR,GUTIME,EVITA<br>
--pipeline SLINKET,S2T,BLINKER,CLASSIFIER,LINK_MERGER
</code>
</blockquote>

The first example instructs TTK to take a file, preprocess it and add
time expressions and events. For the second example, preprocessing,
times and events are taken for granted and only links are added. 

</blockquote>



<a name=gui><h2>5. Using the Toolkit GUI</h2></a>

The Toolkit GUI can be used by typing one of

<blockquote>
<code>
% pythonw gui.py<br/>
% python gui.py
</code>
</blockquote>

Use <code>pythonw</code> when available, <code>python</code>
otherwise. In both cases the wxPython package needs to be
installed. The GUI has three advantages over using the command line
version:

<ol>
<li>It is faster when using on a file-by-file basis because all
libraries are loaded either at start-up or when the first file is processed.
<li>It is easier to use.
<li>It allows the user to type some input and see what happens.
</ol>

The main disadvantage is that it is not possible to process all files
in a directory. Here's a screen shot:

<blockquote>
<img src="gui-1.png" width="800" height="480"/>
</blockquote>

There is no separate manual for the GUI, but usage should be pretty
straightforward. Functionality can be summed up as follows:

<ul>

<li>Use "Load File" to select a file to be processed. 

<li>Use "Load Text" to type in text. This will create a file in
the <code>data/in/User</code> directory, which is then selected as the
input file.

<li>Use the"Document Type", "Trap Errors" and "Content Tag" pull-downs
and text field to enter processing options. Setting the "Document
Type" option will set the "Content Tag" text field to the default for
the document type. It will also select the default components for the
document type. The default components can be overridden by checking
and unchecking the component check boxes. Note that the three
pre-processing components are all either on or off.

<li>Use "Process File" to process the input file conform to the selected settings.

<li>Finally, "View Results" will pop up a new window that displays the
processing results in a more informative way (the large text field in
the control panel just prints the result file as is). The buttons in
the results view control what is shown in it. There are two
exceptions: (i) the "Graph" button will start the Tango annotation
tool on the results file, showing a graph of the annotation and
including a "TBox" button which displays an alternative format, and
(ii) the "TBox" button doesn't do anything yet, in the future it will
provide a more direct way to the TBox representation.

</ul>


<a name=codedocs><h2>6. More Documentation</h2></a>


<p><a href="../design/index.html">design</a></p>


<p>Even with all the updates for version 2.0, documentation of the code is still
uneven: some modules are well-documented, other have spotty and underwhelming
documentation, and yet others are not documented at all. To create browsable
documentation in <a href="../code/index.html">docs/code</a> you can use
the <code>make_documentation.py</code> script:

<blockquote>
<code>
% cd code/utilities<br>
% python make_documentation.py 
</code>
</blockquote>

<p>This creates a file <code>index.html</code> with a list of links to all
modules. For each module, and each class and function in that module,
the documentation strings are printed. There are also links to the
source code of each function.</p>

<p>This script was created because the <code>pydoc</code> command used to crash
on many of the toolkit modules.</p>


<a name=issues><h2>7. Known Issues</h2></a>


<li>Bad CPU type in executable

<p>This error may be thrown by the bin/tree-tagger executable in the treetagger
directory. You have the wrong executable. Install the correct version for your
operating system.</p>

<li>TreeTagger parameter file invalid: english.par

<p>This is thrown by components.preprocessing.treetaggerwrapper.TreeTaggerError
and it can occur when your versions of the treetagger and the treetaggerwrapper
script are out of sync. Find the line

<blockquote>
"tagparfile": "english.par",
</blockquote>

and replace it with

<blockquote>
"tagparfile": "english-utf8.par",
</blockquote>

Note that this should really be fixed by using the new treetaggerwrapper.</p>


<a name=contrib><h2>7. Contributors</h2></a>

Many people have contributed to the Tarsqi toolkit, they are listed
here in alphabetical order: Catherine Havasi, Seokbae Jang, Bob
Knippen, Congmin Lee, Inderjeet Mani, Emin Mimaroglu, Jessica
Moszkowicz, Feng Pan, Alex Plotnick, James Pustejovsky, Hongyuan Qiu,
Anna Rumshisky, Roser Saur&iacute;, Barry Schiffman, Amber Stubbs,
Marc Verhagen, and Ben Wellner.

<p>
The Tango annotation tool was developed by Linda van Guilder, Andrew
See, Bob Knippen and Alex Baron.






<a name=contact><h2>8. Contact</h2></a>


If you have problems installing the toolkit or if you want to report a
bug, please send an email to ttk-bugs@timeml.org. When reporting a
bug, please tell us what platform you're using (including Perl and
Python versions) and include a file that illustrates the errant
behavior. A database with known issues will be made available on the
web site.

<p>

Suggestions, criticisms, disappointments, feature requests and kudos
are also welcome at the above address.



<a name=future><h2>9. Future Work</h2></a>


The next major revision of the TARSQI Toolkit will be numbered 1.1 and will
be released in early 2008. Minor revisions will be released with
version number 1.0.X and will concentrate on bug fixes (as well as on
providing a non-problematic Windows version).

<p>

The following major changes to the code base are now in progress or
under consideration:


<ol>

<li>Re-implement the temporal closure code into Python and integrate it
better with the toolkit. Includes major speed optimizations (the
temporal closure components is by far the slowest component of the
toolkit and it slows down to a crawl on large documents).

<li>Re-implement GUTime in Python, splitting it into two components,
one to add the TIMEX3 tags and one to fill in the VAL field.

<li>Eliminate all remaining Perl components (glue scripts and filtering
scripts) and replace them with Python components

<li>Use standoff annotation instead of in-line XML. This would make it
much easier to deal with existing tags.

<li>Finish porting all rule types from GutenLink to Blinker

<li>Hook up the toolkit to other pre-processing components (for
example the NLTK toolkit).

<li>Add browsers and editors for the dictionaries and pattern sets.

<li>Improve on the merging code. It seems to throw away a few to many
temporal links that are considered high-precision (most notable links
between timex tags generated by Blinker).

<li>Add a <code>text</code> document type.

</ol>

A much longer list of feature requests and known bugs will be put on
the toolkit website in the near future.


</body>
</html>
